<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title><%- title %></title>
    <base href="/">
    <link href="/css/general.css" rel="stylesheet" type="text/css"/>
    <link href="/css/projectInfo.css" rel="stylesheet" type="text/css"/>
    <link href="/fontawesome/css/all.min.css" rel="stylesheet" type="text/css"/>
    <script src="/lib/lz-string.min.js"></script>
    <script src="/lib/angular.min.js"></script>
    <script>
        var app = angular.module("dashboard",[]);
        app.config(function($locationProvider){
            $locationProvider.html5Mode(true);
        });
    </script>
    <script src="/js/general.js"></script>
    <script src="/js/doc.js"></script>
    <script src="/js/dataManager.js"></script>
    <script src="/js/projectFilter.js"></script>
    <script src="/js/projectInfo.js"></script>
    <script src="/js/projectInfoDocCon.js"></script>
    <script src="/js/projectInfoInfoCon.js"></script>
    <script src="/js/projectInfoAlertCon.js"></script>
    <script src="/js/projectInfoBugCon.js"></script>
    <script src="/js/projectInfoCommentCon.js"></script>
    <script src="/js/projectInfoPaymentCon.js"></script>
    <script src="/js/projectInfoReleaseCon.js"></script>
    <script src="/js/projectInfoPurchaseCon.js"></script>
    <style>
        #alertTypeSelector >button{
            width:3rem;
            margin-left:0.5rem;
        }

        #alertTypeSelector >button:hover{
            opacity:0.6;
        }

        #alertTypeSelector >button:disabled:hover{
            opacity:0.6;
        }

        #alertTypeSelector >button:disabled{
            filter: grayscale(100%);
            opacity:0.6;
        }

        #alertTypeSelector >button >div{
            width:100%;
            height:1rem;
        }

        #docDetail >div{
            margin-bottom:0.5rem;

        }

        .buttonFunc >button{
            margin-left:0.5rem;
        }

        .buttonFunc >a {
            text-decoration:none;
        }

        .task-record{
            padding-left:0.5rem;
            display:flex;
            flex-direction:row;
            border-radius:5px;
            padding-top:2px;
            padding-bottom:2px;
        }
    </style>
</head>


<body ng-app="dashboard"
      ng-controller="rootCon">
<info-receiver  ng-init="project = '<%= encodeURIComponent(JSON.stringify(contents)) %>';
                         users = '<%= encodeURIComponent(JSON.stringify(users)) %>';
                         user = '<%= encodeURIComponent(JSON.stringify(user)) %>';
                         setting = '<%= encodeURIComponent(JSON.stringify(setting)) %>';"></info-receiver>
<div id="header">
    <div style="margin-top:auto;margin-bottom:auto;margin-left:1.5rem;"><%- header %></div>
    <div id="headerButtons">
        <a href="/account" target="_blank">ACCOUNT</a>
        <a href="/tutorial" target="_blank">REFERENCE</a>
    </div>
</div>
<div id="statusBar" style="display:flex;flex-direction:row;">
    <a href="/" target="_self">首页</a> > 当前状态:<span >{{project.status | status}}</span>
    <div style="margin-left:auto;"><button ng-click="hangProject()" ng-disabled="project.status === 7">HANG</button></div>
</div>
<div class="mainContents" ng-controller="infoCon">
    <div id="projectInfo">
        <div><div>platform:</div><div delivery-info info="platform"></div></div>
        <div><div>OS:</div><div delivery-info info="OS"></div></div>
        <div><div>current release:</div><div>{{currentRelease.title}}</div></div>
        <div><div>Active:</div>
            <select id="activeSelect" ng-model="projectDetail.active" ng-options="activeOption.value as activeOption.name for activeOption in activeOptions"></select>
        </div>
        <div><div>Account:</div><div info="{{project.account}}" type="name" account-info></div></div>
        <div>
        <div>Contacts:</div>
        <div>
           <div ng-repeat="contact in project.projectContacts">
               <button  ng-if="$index < 1" ng-click="showProjectContacts()" class="inlineBtn" style="padding:0;height:1rem;margin-right:0.5rem;">{{contact.name}}<{{contact.mail}}></button><button ng-click="mailTo(contact)" class="linkBtn" style="font-size:0.8rem;">MAIL</button>
           </div>
        </div>
        </div>
        <div style="width:100%;"><div>FTP:</div><div upload-account account="{{project.FTP}}"></div></div>
        <div style="width:100%;"><div>Address:</div><div address-format account="{{project.address}}"></div></div>
        <div style="width:100%;"><div>Account Docs:</div><button class="simpleBtn" style="font-weight:bold;margin-left:4rem;" ng-click="addReferenceDoc()">ADD</button></div>
        <div style="width:100%">
            <table class="dataListTable" style="margin-left:8rem;">
                <tr ng-if="companyDocs.length === 0"><td colspan="4"><b>No Account Docs</b></td></tr>
                <tr ng-repeat="cd in companyDocs">
                    <td style="min-width:12rem;">{{cd.name}}</td>
                    <td>{{cd.date | date:'&y-&m-&d'}}</td>
                    <td content-format contents="{{cd.description}}" style="padding-left:1.5rem;"></td>
                    <td content-format contents="{{cd.reference}}" style="padding-left:1.5rem;"></td>
                    <td><div doc-source doc="cd"></div></td>
                </tr>
            </table>
        </div>
        <div style="width:100%;"><div>Reference:</div><button class="simpleBtn" style="font-weight:bold;margin-left:4rem;" ng-click="addReferenceDoc()">ADD</button></div>
        <div style="width:100%">
            <table class="dataListTable" style="margin-left:8rem;">
                <tr ng-if="referenceDocs.length === 0"><td colspan="4"><b>No Reference Docs added</b></td></tr>
                <tr ng-repeat="reference in referenceDocs">
                    <td style="min-width:12rem;">{{reference.name}}</td>
                    <td>{{reference.date | date:'&y-&m-&d'}}</td>
                    <td content-format contents="{{reference.description}}" style="padding-left:1.5rem;"></td>
                    <td content-format contents="{{reference.reference}}" style="padding-left:1.5rem;"></td>
                    <td><div doc-source doc="reference"></div></td>
                </tr>
            </table>
        </div>
    </div>
</div>

<div class="mainContents" ng-controller="alertCon">
    <div style="width:100%;display:flex;flex-direction:row;font-size:1.1rem;margin-top:-1rem;">
        <div style="font-weight:bold;margin-left:1rem;">DASHBOARD</div>
        <div style="margin-left:auto;">
            <a class="inlineBtn" style="padding:0;margin-right:2rem;font-size:1.5rem;" href="{{}}">...</a>
        </div>
    </div>
    <div style="width:100%;border-bottom:solid 1px lightgray;padding-bottom:0.5rem;"></div>
    <div style="display:flex;flex-direction:row;" id="alertTypeSelector">
        <button class="inlineBtn" ng-repeat="x in [].constructor(maxType) track by $index" ng-click="changeType($index)" task-type type="{{$index}}" ng-disabled="$index === taskType"></button>
        <div style="margin-left:auto;height:38px;line-height:38px;">HOURS/DAY</div>
        <div class="switch-box" style="margin-left:1rem;margin-top:4px;">
            <input id="switchButton" type="checkbox" class="switch" ng-model="dayOrHour" />
            <label for="switchButton"></label>
        </div>
        <button style="margin-left:2rem;margin-right:2rem;height:1.5rem;margin-top:0.5rem;" ng-click="ExportExcel()">Export</button>
        <a id="dlink" style="opacity:0;height:1px;"></a>
        <button style="margin-left:2rem;margin-right:2rem;height:1.5rem;margin-top:0.5rem;" ng-click="newTask()">NEW</button>
    </div>

    <div ng-show="records.length >0" style="display:flex;flex-direction:column;">
        <div id="taskBoard">
            <div ng-repeat="rec in records" ng-show="rec.type === taskType && !duplicate(rec)" style="display:flex;flex-direction:column;margin-top:0.5rem;margin-left:0.5rem;">
                <div class="task-record" task-status status="{{rec.status}}" >
                    <div task-type type="{{rec.type}}" style="font-size:0.8rem;"></div>
                    <div style="margin-right:1rem;margin-left:1rem;line-height:1.5rem;max-width:25rem;width:25rem;">{{rec.title}}</div>
                    <div hrs-sign style="margin-right:1rem;line-height:1.5rem;" hrs="{{rec.hours}}" rec="{{rec}}">{{rec.hours + 'hrs'}}</div>
                    <div style="line-height:1.5rem;margin-right:1rem;">{{rec.plan.start | date:'&y/&m/&d'}}</div>
                    <div style="line-height:1.5rem;margin-right:1rem;">{{rec.plan.end | date:'&y/&m/&d'}}</div>
                    <div style="line-height:1.5rem;margin-right:1rem;">{{rec.completed | date:'&y/&m/&d'}} <span ng-show="!rec.completed">UNCOMPLTED</span></div>
                    <div style="line-height:1.5rem;margin-right:1rem;" rec="{{rec}}" hrs-sign hrs="{{rec.plan.hours}}">{{rec.plan.hours + 'hrs'}}</div>
                    <div class="buttonFunc" style="line-height:1rem;display:flex;flex-direction:row;">
                        <button class="inlineBtn" style="font-weight:bold;font-size:1rem;height:1rem;" ng-click="newChildTask(rec)">+</button>
                        <button class="inlineBtn" style="font-size:1rem;margin-left:0;" ng-click="editTask(rec)" ng-disabled="rec.status >=4"><i class="fas fa-pen" style="margin:auto;"></i></button>
                        <a class="inlineBtn" style="margin-top:0;margin-bottom:auto;font-weight:bold;font-size:0.3rem;height:1rem;" target="_blank" href="{{'task/info?id='+ rec._id}}">●●●</a></div>
                </div>
                <div>
                    <div ng-repeat="child in rec.children" style="margin-left:1rem;display:flex;flex-direction:column;" task-status status="{{child.status}}">
                       <div class="task-record">
                        <div task-type type="{{child.type}}" style="font-size:0.4rem;"></div>
                        <div style="margin-right:1rem;margin-left:1rem;line-height:1.5rem;max-width:25rem;width:25rem;">{{child.title}}</div>
                        <div hrs-sign style="margin-right:1rem;line-height:1.5rem;" hrs="{{child.hours}}" rec="{{rec}}">{{child.hours + ' hrs'}}</div>
                        <div style="line-height:1.5rem;margin-right:1rem;">{{child.plan.start | date:'&y/&m/&d'}}</div>
                        <div style="line-height:1.5rem;margin-right:1rem;">{{child.plan.end | date:'&y/&m/&d'}}</div>
                        <div style="line-height:1.5rem;margin-right:1rem;">{{child.completed | date:'&y/&m/&d'}} <span ng-show="!child.completed">UNCOMPLTED</span></div>
                        <div style="line-height:1.5rem;margin-right:1rem;" hrs-sign rec="{{child}}" hrs="{{child.plan.hours}}" >{{child.plan.hours + ' hrs'}}</div>
                        <div class="buttonFunc" style="line-height:1rem;display:flex;flex-direction:row;">
                            <button class="inlineBtn" style="font-weight:bold;font-size:1rem;height:1rem;" ng-click="newChildTask(child)">+</button>
                            <button class="inlineBtn" style="font-size:0.3rem;margin-left:0;" ng-click="editTask(child)" ng-disabled="child.status >=4"><i class="fas fa-pen" style="margin:auto;"></i></button>
                            <a class="inlineBtn" style="margin-top:0;margin-bottom:auto;font-weight:bold;line-height:0.5rem;" target="_blank" href="{{'task/info?id='+ child._id}}">…</a></div>
                       </div>
                       <div ng-repeat="child2 in child.children" class="task-record" style="margin-left:1rem;display:flex;flex-direction:column;">
                           <div class="task-record" style="" task-status status="{{child2.status}}">
                            <div task-type type="{{child2.type}}" style="font-size:0.4rem;"></div>
                            <div style="margin-right:1rem;margin-left:1rem;line-height:1.5rem;max-width:25rem;width:25rem;">{{child2.title}}</div>
                            <div hrs-sign style="margin-right:1rem;line-height:1.5rem;" hrs="{{child2.hours}}" rec="{{rec}}">{{child2.hours + ' hrs'}}</div>
                            <div style="line-height:1.5rem;margin-right:1rem;">{{child2.plan.start | date:'&y/&m/&d'}}</div>
                            <div style="line-height:1.5rem;margin-right:1rem;">{{child2.plan.end | date:'&y/&m/&d'}}</div>
                            <div style="line-height:1.5rem;margin-right:1rem;">{{child2.completed | date:'&y/&m/&d'}} <span ng-show="!child2.completed">UNCOMPLTED</span></div>
                            <div style="line-height:1.5rem;margin-right:1rem;" hrs-sign rec="{{child2}}" hrs="{{child2.plan.hours}}" >{{child2.plan.hours + ' hrs'}}</div>
                            <div class="buttonFunc" style="line-height:1rem;display:flex;flex-direction:row;">
                                <button class="inlineBtn" style="font-weight:bold;font-size:1rem;height:1rem;" ng-click="newChildTask(child2,2)">+</button>
                                <button class="inlineBtn" style="font-size:0.3rem;margin-left:0;" ng-click="editTask(child2)" ng-disabled="child2.status >=4"><i class="fas fa-pen" style="margin:auto;"></i></button>
                                <a class="inlineBtn" style="margin-top:0;margin-bottom:auto;font-weight:bold;line-height:0.5rem;" target="_blank" href="{{'task/info?id='+ child2._id}}">…</a></div>
                           </div>
                           <div ng-repeat="child3 in child2.children" class="task-record" style="margin-left:1rem;display:flex;flex-direction:column;">
                               <div class="task-record" style="" task-status status="{{child3.status}}">
                                   <div task-type type="{{child3.type}}" style="font-size:0.4rem;"></div>
                                   <div style="margin-right:1rem;margin-left:1rem;line-height:1.5rem;max-width:25rem;width:25rem;">{{child3.title}}</div>
                                   <div hrs-sign style="margin-right:1rem;line-height:1.5rem;" hrs="{{child3.hours}}" rec="{{rec}}">{{child3.hours + ' hrs'}}</div>
                                   <div style="line-height:1.5rem;margin-right:1rem;">{{child3.plan.start | date:'&y/&m/&d'}}</div>
                                   <div style="line-height:1.5rem;margin-right:1rem;">{{child3.plan.end | date:'&y/&m/&d'}}</div>
                                   <div style="line-height:1.5rem;margin-right:1rem;">{{child3.completed | date:'&y/&m/&d'}} <span ng-show="!child3.completed">UNCOMPLTED</span></div>
                                   <div style="line-height:1.5rem;margin-right:1rem;" hrs-sign rec="{{child3}}" hrs="{{child3.plan.hours}}" >{{child3.plan.hours + ' hrs'}}</div>
                                   <div class="buttonFunc" style="line-height:1rem;display:flex;flex-direction:row;">
                                       <button class="inlineBtn" style="font-weight:bold;font-size:1rem;height:1rem;" ng-click="newChildTask(child3,3)">+</button>
                                       <button class="inlineBtn" style="font-size:0.3rem;margin-left:0;" ng-click="editTask(child3)" ng-disabled="child3.status >=4"><i class="fas fa-pen" style="margin:auto;"></i></button>
                                       <a class="inlineBtn" style="margin-top:0;margin-bottom:auto;font-weight:bold;line-height:0.5rem;" target="_blank" href="{{'task/info?id='+ child3._id}}">…</a></div>
                               </div>
                               <div ng-repeat="child4 in child3.children" class="task-record" style="margin-left:1rem;display:flex;flex-direction:column;">
                                   <div class="task-record" style="" task-status status="{{child4.status}}">
                                       <div task-type type="{{child4.type}}" style="font-size:0.4rem;"></div>
                                       <div style="margin-right:1rem;margin-left:1rem;line-height:1.5rem;max-width:25rem;width:25rem;">{{child4.title}}</div>
                                       <div hrs-sign style="margin-right:1rem;line-height:1.5rem;" hrs="{{child4.hours}}" rec="{{rec}}">{{child4.hours + ' hrs'}}</div>
                                       <div style="line-height:1.5rem;margin-right:1rem;">{{child4.plan.start | date:'&y/&m/&d'}}</div>
                                       <div style="line-height:1.5rem;margin-right:1rem;">{{child4.plan.end | date:'&y/&m/&d'}}</div>
                                       <div style="line-height:1.5rem;margin-right:1rem;">{{child4.completed | date:'&y/&m/&d'}} <span ng-show="!child4.completed">UNCOMPLTED</span></div>
                                       <div style="line-height:1.5rem;margin-right:1rem;" hrs-sign rec="{{child4}}" hrs="{{child4.plan.hours}}" >{{child4.plan.hours + ' hrs'}}</div>
                                       <div class="buttonFunc" style="line-height:1rem;display:flex;flex-direction:row;">
                                           <button class="inlineBtn" style="font-weight:bold;font-size:1rem;height:1rem;" ng-click="newChildTask(child4,3)">+</button>
                                           <button class="inlineBtn" style="font-size:0.3rem;margin-left:0;" ng-click="editTask(child4)" ng-disabled="child4.status >=4"><i class="fas fa-pen" style="margin:auto;"></i></button>
                                           <a class="inlineBtn" style="margin-top:0;margin-bottom:auto;font-weight:bold;line-height:0.5rem;" target="_blank" href="{{'task/info?id='+ child4._id}}">…</a></div>
                                   </div>
                                   <div ng-repeat="child5 in child4.children" class="task-record" style="margin-left:1rem;display:flex;flex-direction:column;">
                                       <div class="task-record" style="" task-status status="{{child5.status}}">
                                           <div task-type type="{{child5.type}}" style="font-size:0.4rem;"></div>
                                           <div style="margin-right:1rem;margin-left:1rem;line-height:1.5rem;max-width:25rem;width:25rem;">{{child5.title}}</div>
                                           <div hrs-sign style="margin-right:1rem;line-height:1.5rem;" hrs="{{child5.hours}}" rec="{{rec}}">{{child5.hours + ' hrs'}}</div>
                                           <div style="line-height:1.5rem;margin-right:1rem;">{{child5.plan.start | date:'&y/&m/&d'}}</div>
                                           <div style="line-height:1.5rem;margin-right:1rem;">{{child5.plan.end | date:'&y/&m/&d'}}</div>
                                           <div style="line-height:1.5rem;margin-right:1rem;">{{child5.completed | date:'&y/&m/&d'}} <span ng-show="!child5.completed">UNCOMPLTED</span></div>
                                           <div style="line-height:1.5rem;margin-right:1rem;" hrs-sign rec="{{child5}}" hrs="{{child5.plan.hours}}" >{{child5.plan.hours + ' hrs'}}</div>
                                           <div class="buttonFunc" style="line-height:1rem;display:flex;flex-direction:row;">
                                               <button class="inlineBtn" style="font-weight:bold;font-size:1rem;height:1rem;" ng-click="newChildTask(child5,3)">+</button>
                                               <button class="inlineBtn" style="font-size:0.3rem;margin-left:0;" ng-click="editTask(child5)" ng-disabled="child5.status >=4"><i class="fas fa-pen" style="margin:auto;"></i></button>
                                               <a class="inlineBtn" style="margin-top:0;margin-bottom:auto;font-weight:bold;line-height:0.5rem;" target="_blank" href="{{'task/info?id='+ child5._id}}">…</a></div>
                                       </div>
                                   </div>
                               </div>
                           </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div style="min-height:3.5rem;display:flex;margin-bottom:-1.5rem;" ng-show="refreshing">
        <i class="fa fa-spinner fa-spin" style="margin:auto;"></i>
    </div>
    <div style="min-height:3.5rem;display:flex;flex-direction:column;margin-bottom:-1.5rem;" ng-show="records.length === 0 && !refreshing">
        <div style="margin:auto;font-weight:bold;height:1rem;">NO&nbsp&nbsp&nbsp&nbspTASKS</div>
    </div>
</div>

<div style="display:flex;flex-direction:row;margin-left:2.5rem;" id="tabParent">
    <div tab-button>comments</div>
    <div tab-button>release history</div>
    <div tab-button>bugfix</div>
    <div tab-button>contracts</div>
    <div tab-button>payment</div>
    <div tab-button>purchase order</div>
</div>

<div  class="mainContents">
    <div ng-show="currentPage === 'comments'" style="display:flex;flex-direction:column;" id="commentPanel" ng-controller="commentCon">
        <div ng-repeat="comment in comments" style="padding-top:1rem;padding-bottom:1rem;border-bottom:1px solid lightgray">
            <div style="display:flex;flex-direction:row;" class="subRow">
                <div>提交人：{{comment.user.name}}</div>
                <div>提交日期：{{comment.date | date:'&y/&m/&d &h:&i:&s'}}</div>
                <div>status：{{comment.status | status}}</div>
            </div>
            <div style="display:flex;flex-direction:row;min-height:1rem;margin-left:1.5rem;margin-right:1.5rem;padding:0.5rem;" class="subRow">
                <span ng-repeat="attach in comment.attachments" class="backGrayBtn" style="padding:5px;margin-right:0.5rem;" ng-click="openAttach(attach.link,attach.name)">
                    <img src="{{attach.name | linkIcon}}" style="width:1.2rem;margin-left:0.5rem;">
                     <span style="max-width:6rem;">{{attach.name}}</span>
                </span>
            </div>
            <div style="padding-left:2rem;padding-right:2rem;padding-top:0.5rem;" content-format contents="{{comment.comment}}">{{comment.comment}}</div>
        </div>
        <div style="margin:auto;" ng-show="requesting"> <i class="fa fa-spinner fa-spin fa-3x" style="margin:auto;"></i></div>
        <div class="pageCount" style="margin-top:1rem;margin-bottom:0.5rem;">
            <div ng-if="startIndex>1"><button ng-click="goToCommentPage(1)">1</button></div>
            <div ng-if="startIndex>2">…</div>
            <div ng-repeat="x in [].constructor(7) track by $index">
                <button ng-if="$index+startIndex <= page"
                        ng-click="goToCommentPage($index+startIndex)"
                        ng-disabled="pageId - startIndex === $index">{{$index+startIndex}}</button></div>
            <div ng-if="startIndex+7 < pageMax">…</div>
            <div ng-if="startIndex+7 <= page">
                <button ng-click="goToCommentPage(pageMax)">{{pageMax}}</button>
            </div>
        </div>
        <div style="display:flex;flex-direction:row;margin-top:2rem;">
            <div style="margin-left:1rem;">提交人：{{userInfo.name}}</div>
            <div style="margin-left:4rem;">schedule：</div>
            <input ng-disabled="!updatable()" type="date" id="commentTime">
            <div style="margin-left:4rem;">status：</div>
            <select ng-disabled="!updatable()" ng-model="projectUpdate.status">
                <option value="0">opportunities</option>
                <option value="1">business</option>
                <option value="2">development</option>
                <option value="3">delivery </option>
                <option value="4">MP</option>
                <option value="7">PENDING</option>
            </select>
        </div>
        <div style="display:flex;flex-direction:row;">
            <div style="flex:1;display:flex;flex-direction:row;flex-wrap:wrap;margin-left:2rem;">
                <span ng-repeat="attach in attachments" style="margin-right:0.5rem;">
                     <img src="{{attach.name | linkIcon}}" style="width:1.2rem;margin-left:0.5rem;">
                     <span style="max-width:6rem;">{{attach.name}}</span>
                     <button  class="closeBtnInline" ng-click="deleteAttach(attach)"><i class="fas fa-times-circle"></i></button>
                </span>
            </div>
            <div style="display:flex;flex-direction:row;margin-left:auto;border-radius:3px; background:rgba(230,230,230,0.8);padding:0.5rem;margin-right:2rem;box-shadow: 4px 0 5px -3px rgba(185,185,185,0.8);">
            <input  id="attachUpload" style="margin-left:auto;" type=file>
            <button ng-click="uploadAttach()" style="margin-left:0.5rem;">Upload</button>
            </div>
        </div>
        <textarea ng-model="commentSubmit.contents" ng-disabled="!updatable()"></textarea>
        <div style="display:flex;flex-direction:row;">
            <button class="submitButton" ng-click="submitComment()" ng-disabled="!updatable()">提交</button>
        </div>
    </div>

    <div ng-show="currentPage === 'release history'" style="display:flex;flex-direction:column;" ng-controller="releaseCon">
        <button style="margin-left:auto;margin-right:2rem;margin-bottom:1.5rem;" class="simpleBtn" ng-click="showCover('release')">ADD RELEASE</button>
        <table style="margin-left:auto;margin-right:auto;" class="dataListTable">
            <tr>
                <td>VERSION</td>
                <td>DESCRIPTION</td>
                <td>UPLOADED</td>
                <td>DOWNLOAD</td>
                <td>QA REPORT</td>
            </tr>
        <tr ng-show="versions.length === 0">
           <td colspan="5" style="text-align:center;"><b>No record of versions under this project</b></td>
        </tr>
        <tr ng-repeat="release in versions" class="entry">
                <td valign="top"style="line-height:1.5rem;height:1.5rem;">{{release.version.main}}.{{release.version.update}}.{{release.version.fix}}</td>
                <td valign="top"><div  style="width:25rem;min-width:25rem;margin:0;text-overflow:ellipsis;height:1.5rem;word-break:break-all;overflow:hidden;"
                                       content-format
                                       contents={{release.description}}></div></td>
                <td valign="top">{{release.date | date:'&y-&m-&d &h:&i:&s'}}</td>
                <td valign="top" style="text-align:center">
                    <a href="{{release | positionAndLink}}" target="_blank"><img src="{{release | positionAndLinkIcon}}" style="width:1.2rem;"></a>
                </td>
                <td></td>
                <td valign="top"><button class="inlineBtn" style="transform:scale(1.5);width:1.5rem;" ng-click="expandData($event,release.description)"><i class="fa fa-angle-down"></i></button></td>
        </tr>
        </table>
    </div>

    <div ng-show="currentPage=='contracts'" style="display:flex;flex-direction:column;" ng-controller="docCon">
        <button style="margin-left:auto;margin-right:2rem;" class="simpleBtn" ng-click="showCover('contracts')">ADD DOCUMENT</button>
        <table style="margin-left:auto;margin-right:auto;margin-top:2rem;" class="dataListTable">
            <tr>
                <td>NAME</td>
                <td>DATE</td>
                <td>Description</td>
                <td>TYPE</td>
                <td>DOWNLOAD</td>
                <td>HISTORY</td>
                <td>REFERENCE</td>
                <td></td>
            </tr>
            <tr ng-show="docs.length === 0"><td colspan="7" style="text-align:center;">
                <b>No record of bugs under this project</b>
            </td></tr>
            <tr ng-repeat="doc in docs">
                <td>{{doc.name}}</td>
                <td>{{doc.date | date:'&y-&m-&d &h:&i:&s'}}</td>
                <td content-format contents="{{doc.description}}" style="width:15rem;"></td>
                <td><b>{{doc.type | docType}}</b></td>
                <td>
                    <div style="text-align:center;" ng-if="doc.link!==''"><a href="{{doc | docLink:'1'}}" target="_blank"><img src="{{doc | docIcon}}" style="width:1.2rem;"></a></div>
                    <div style="text-align:center;"><button class="simpleBtnRight" ng-click="modify(doc)">{{doc.link === ''? 'ADD':'MODIFY'}}</button></div>
                </td>
                <td>
                    <div ng-if="(doc.history && doc.history.length === 0) || !doc.history" style="margin-top:auto;margin-bottom:auto;">Not re-uploaded</div>
                    <div style="display:flex;flex-direction:column;">
                    <span ng-repeat="rec in doc.history">{{rec.date | date:'&y/&m/&d'}}<img src="{{rec.link | linkIcon}}" style="width:1.2rem;margin-left:0.5rem;"></span>
                    </div>
                </td>
                <td content-format contents="{{doc.reference}}" style="width:15rem;"></td>
                <td style="padding-right:2rem;">
                    <button class="closeButtonInline" ng-click="deleteDocument(doc)"><i class="fas fa-times-circle" style="transform:scale(1.5);"></i></button>
                </td></tr>
        </table>
    </div>

    <div ng-show="currentPage=='bugfix'" style="display:flex;flex-direction:column;" ng-controller="bugCon">
        <button style="margin-left:auto;margin-right:2rem;" class="simpleBtn" ng-click="showCover('bugfix')">ADD BUGFIX</button>
        <table style="margin-left:auto;margin-right:auto;margin-top:2rem;border-collapse:collapse;" class="dataListTable">
            <tr style="font-weight:bold;">
                <td>TITLE</td>
                <td>DATE</td>
                <td>VERSION</td>
                <td>DEVELOPER</td>
                <td>COMMENT</td>
                <td>LOG</td>
                <td style="text-align:center;" >STATUS</td>
            </tr>
            <tr ng-show="bugs.length === 0" style="text-align:center;margin-top:1rem;font-size:1rem;">
                <td colspan="6"><b>No record of bugs under this project</b></td></tr>
            <tr ng-repeat="bug in bugs" style="border-bottom:solid 1px lightgray;">
                <td style="max-width:12rem;">{{bug.title}}</td>
                <td>{{bug.date | date:'&y/&m/&d'}}</td>
                <td>{{bug.version|version}}</td>
                <td style="display:flex;flex-direction:column;padding-top:1.2rem;">
                    <div ng-repeat="developer in bug.developers">◉ {{developer.name}}</div>
                </td>
                <td style="width:22rem;max-width:15rem;white-space:normal;word-break:break-all;max-height:12rem;overflow-y:auto;padding-bottom:1.2rem;padding-top:1.2rem;padding-right:0.5rem;padding-left:0.5rem;"
                    content-format contents="{{bug.comment}}">{{bug.comment}}</td>
                <td style="min-width:20rem;padding-left:1rem;padding-right:0.5rem;margin-bottom:1rem;"><div style="display:flex;flex-direction:column;height:12rem;">
                        <div style="display:flex;flex-direction:row;padding-top:1.2rem;">
                            <button class="simpleBtn"
                                    style="margin-left:0.5rem;margin-right:auto;"
                                    ng-click="addLog(bug)">add</button>
                            <button class="simpleBtn"
                                    ng-show="bug.logs.length>0"
                                    style="margin-right:0.5rem;margin-bottom:0.5rem;"
                                    ng-click="viewAllLog(bug)">view all</button>
                        </div>
                        <div style="flex:1;margin-top:0.8rem;">
                            <div ng-repeat="log in bug.logs" style="display:flex;flex-direction:row;" ng-if="$index < 5">
                                <div style="margin-right:0.5rem;padding-left:1rem;">{{log.date | date:'&y/&m/&d'}}</div>
                                <div style="margin-right:0.5rem;">{{log.user.name}}</div>
                                <div style="margin-right:0.5rem;">{{log.contents | shortenContents}}</div>
                            </div>
                            <div ng-if="bug.logs.length>5" style="text-align:center;">...</div>
                            <div ng-if="bug.logs.length ===0" style="font-weight:bold;text-align:center;font-weight:bold;">No logs added so far</div>
                        </div>
                 </div></td>
                <td style="text-align:center;"><button class="inlineBtn" ng-click="changeTaskStatus(bug)" style="font-size:1.2rem;" >{{bug.status | bugStatus}}</button></td>
            </tr>
        </table>
    </div>

    <div ng-show="currentPage=='payment'" style="display:flex;flex-direction:column;" ng-controller="paymentCon">
        <div style="margin-left:auto;margin-right:2rem;font-family:Arial,serif;">
            <button  class="simpleBtn" ng-click="showCover('payment')">Add payment</button>
            <a class="simpleBtn" href="/accounting/payment" target="_blank" style="text-decoration:none;margin-left:1.5rem;">View more</a>
        </div>
        <table class="dataListTable" style="margin-left:auto;margin-right:auto;margin-top:2rem;font-size:0.9rem;">
            <tr><td>PO</td><td>DATE</td></td><td>PAYMENT</td><td style="text-align:center;">STATUS</td><td>COMMENT</td><td>INVOICE</td><td>DOC</td><td></td></tr>
            <tr ng-show="payments.length ===0"><td colspan="8" style="text-align:center;">
                <b>No Payments Record for this project</b>
            </td></tr>
            <tr><td colspan="4">&nbsp</td></tr>
            <tr ng-repeat="payment in payments">
                <td style="width:6rem;">{{payment.PO}}</td>
                <td style="width:8.5rem;">{{payment.date | date:'&y/&m/&d &h:&i:&s'}}</td>
                <td style="width:4.5rem;">{{payment.amount}} {{payment.currency | currency}}</td>
                <td payment-status status="{{payment.status}}" style="text-align:center;width:4rem;">{{payment.status | payStatus}}</td>
                <td content-format contents="{{payment.comment}}" style="width:18rem;"></td>
                <td doc-link contents="{{payment.invoice}}" type="invoice" style="text-align:left;min-width:10rem;"></td>
                <td doc-link contents="{{payment.doc}}" type="doc" style="text-align:left;min-width:10rem;"></td>
                <td style="display:flex;flex-direction:column;text-align:center;">
                    <button ng-click="edit(payment)" class="linkBtn">EDIT</button>
                    <button ng-click="delete(payment)" class="linkBtn" style="margin-top:0.5rem;">DELETE</button></td>
            </tr>
        </table>
    </div>


    <div ng-show="currentPage === 'purchase order'" style="display:flex;flex-direction:column;" ng-controller="purchaseCon">
        <div style="margin-left:auto;margin-right:2rem;font-family:Arial,serif;">
            <button  class="simpleBtn" ng-click="showCover('Purchase')">Add Purchase Order</button>
        </div>
        <table class="dataListTable" style="margin-left:auto;margin-right:auto;margin-top:2rem;">
            <tr><td>PO</td><td>DATE</td></td><td>Amount</td><td style="text-align:center;">Price</td><td>comment</td></tr>
            <tr ng-show="POs.length ===0"><td colspan="8" style="text-align:center;">
                <b>No purchase orders found under this project</b>
            </td></tr>
            <tr><td colspan="4">&nbsp</td></tr>
            <tr ng-repeat="PO in POs">
                <td>{{PO.index}}</td>
                <td>{{PO.date | date:'&y/&m/&d &h:&i:&s'}}</td>
                <td>{{PO.amount}}</td>
                <td>{{PO.price}} {{PO.currency | currency}}</td>
                <td>{{PO.comment}}</td>
                <td style="display:flex;flex-direction:row;">
                    <button ng-click="edit(payment)" style="margin-left:2rem;" class="linkBtn">EDIT</button>
                    <button ng-click="delete(payment)" class="linkBtn" style="margin-left:1rem;">DELETE</button></td>
            </tr>
        </table>
    </div>
</div>

<div id="pageCover" class="coverLayer" style="background:rgba(58,58,58,0.4);position:fixed;display:none;">
    <div class="addDoc" style="position:relative;display:flex;flex-direction:column;">
        <div style="margin:1rem;display:flex;flex-direction:column;overflow-y:auto;" id="coverDetail" ng-if="submitType !== 'task'"></div>
        <div style="margin:1rem;display:flex;flex-direction:column;" ng-controller="newTaskCon" ng-show="submitType === 'task'">
            <div id="docDetail" class="displayTable" style="flex:1;margin-top:0.5rem;">
                <div><input ng-model="newTask.title" placeholder="Task Title(mandatory)" style="min-width:30rem;margin-bottom:0.5rem;" id="titleInput"></div>
                <div id="newTaskType" style="display:flex;flex-direction:row;margin-bottom:0.5rem;height:2rem;position:relative;"><div style="line-height:2rem;height:100%;">Type:</div><div task-type type="{{newTask.type}}" style="padding-top:2px;margin-left:0.5rem;"></div></div>
                <div style="margin-bottom:0.5rem;">Due On: <input  type="date" id="NewTaskDate" ng-model="newTask.dueOn"></div>
                <div  style="display:flex;flex-direction:row;margin-bottom:0.5rem;"><div style="min-width:7.5rem;width:7.5rem;">related version:</div><div>
                    <select ng-disabled="savingTask" ng-model="newTask.version" onmousedown="if(this.options.length>10){this.size=10}" onblur="this.size = 0" style="position:absolute;z-index:95;" onchange="this.size=0">
                        <option value="0">Please select version</option>
                        <option ng-repeat="version in versions" value="{{version._id}}">{{version | versionname}}</option>
                    </select>
                </div></div>
                <div id="starterDateLine">Estimated Start: <input type="date" id="estimatedStarter" ng-model="newTask.plan.start"> </div>
                <div id="endDateLine">Estimated End: <input type="date" id="estimatedEnd" ng-model="newTask.plan.end"></div>
                <div>Estimated Hours: <input value="{{newTask.plan.hours}}"> <button ng-click="calcHour()">auto</button> </div>
                <div><textarea ng-disabled="savingTask" ng-model="newTask.description" style="min-height:8rem;min-width:30rem;border-radius:5px;"></textarea></div>
            </div>
        </div>
        <div style="margin:1rem;display:flex;flex-direction:column;overflow-y:auto;" ng-controller="editTaskCon" ng-show="submitType == 'editTask'">
            <div><input ng-model="newTask.title" placeholder="Task Title(mandatory)" style="min-width:30rem;margin-bottom:0.5rem;" disabled="true"></div>
            <div style="display:flex;flex-direction:row;margin-bottom:0.5rem;height:2rem;position:relative;">
                <div style="line-height:2rem;height:100%;margin-right:8px;">Type:</div>
                <div><select ng-disabled="!switch_type || saving" ng-model="newTask.type" onchange="this.size=0" onmousedown="if(this.options.length>10){this.size=10}" onblur="this.size = 0" style="position:absolute;z-index:99;top:0.5rem;max-width:5rem;">
                             <option value="1">Requirement</option>
                             <option value="2">release</option>
                             <option value="3">QA</option>
                             <option value="0">Issue</option>
                             <option value="4">Documentation</option>
                             <option value="6">task</option>
                             <option value="7">payment</option>
                             <option value="5">Other</option>
                             </select></div>
                <div style="height:2.3rem;margin-left:5.5rem;display:flex;">
                    <button ng-click="editContents('switch_type',$event.target,'type')" style="margin:auto;">EDIT</button>
                </div>
            </div>
            <div style="margin-bottom:0.5rem;">Due On: <input  type="date" ng-model="newTask.dueOn" id="editDueOn"></div>
            <div  style="display:flex;flex-direction:row;margin-bottom:0.5rem;"><div style="min-width:7.5rem;width:7.5rem;">related version:</div><div>
                <select ng-disabled="saving" ng-model="newTask.version" onmousedown="if(this.options.length>10){this.size=10}" onblur="this.size = 0" style="position:absolute;z-index:95;" onchange="this.size=0">
                    <option value="0">Please select version</option>
                    <option ng-repeat="version in versions" value="{{version._id}}">{{version | versionname}}</option>
                </select>
            </div></div>
            <div>Estimated Start: <input type="date" ng-model="newTask.plan.start" id="editStarter" ng-disabled="save || !switch_estimate"> </div>
            <div>Estimated End: <input type="date" ng-model="newTask.plan.end" id="editEnd" ng-disabled="save || !switch_estimate"></div>
            <div>Estimated Hours: <input ng-model="newTask.plan.hours" ng-disabled="save || !switch_estimate">
                <button ng-click="calcHour()" ng-disabled="save || !switch_estimate">AUTO</button>
                <button ng-click="editContents('switch_estimate',$event.target,'plan.start|plan.end|plan.hours')" ng-disabled="save">EDIT</button>
                <button ng-click="cancelContents('switch_estimate',$event.target,'plan.start|plan.end|plan.hours')" ng-disabled="save" ng-show="switch_estimate">CANCEL</button>
            </div>
            <div style="position:relative;border-radius:10px;border:solid 1px rgba(55,55,55,1);margin-top:0.5rem;margin-right:2rem;min-height:8rem;min-width:30rem;background:lightgray;">
                <textarea ng-disabled="saving" ng-show="switch_desc" ng-model="newTask.description" style="resize:none;border:none;margin-left:5px;position:absolute;left:0;top:0;min-height:7rem;min-width:30rem;font-family:arial;"></textarea>
                <div style="font-family:arial;font-size:0.8rem;position:absolute;left:0;top:0;padding:5px;" ng-show="!switch_desc">{{newTask.description}}</div>
                <div style="position:absolute;bottom:0;right:0;padding:5px;">
                    <button ng-click="cancelContents('switch_desc',$event.target,'description')" ng-show="switch_desc">CANCEL</button>
                    <button ng-click="editContents('switch_desc',$event.target,'description')">EDIT</button>
                </div>
            </div>
        </div>
        <div style="display:flex;flex-direction:row;margin-bottom:1.5rem;margin-top:auto;">
            <button style="margin-left:6rem;margin-right:auto;" ng-click="submitDoc()" ng-show="submitSelection != 1">提交</button>
            <button style="margin-left:auto;margin-right:6rem;" ng-click="cancelDoc()">取消</button>
        </div>

        <div class="addDocCover coverLayer" style="z-index:99;background:rgba(218,218,218,0.4);display:flex;" ng-show="saving">
            <i class="fa fa-spinner fa-spin fa-3x" style="margin:auto;"></i>
        </div>
    </div>
</div>

</body>
</html>